# Formatters

Adding context to alerts is done by the formatters. Formatters generate all the content that may
be used by one or more message types. For example, certain parts of text returned by a Nagios check
can be highlighted to grab the operator's attention. Helper functions can be called to generate
additional content such as image attachments or search results.

All content generated by a formatter is stored in a hash (a class instance variable in the
formatter object). The hash looks similar to the following:

```ruby
@content = {
  :attachments => [],
  :html => {
    :additonal_info => "",
    :additional_details => "" 
  },
  :subject => "",
  :text => {
    :additonal_info => "",
    :additional_details => ""
  }
}
```

**NOTE**: The subkeys under the ``:html`` and ``:text`` keys are generated by formatter methods of the
same name.

## Formatter Methods

The base formatter (``Formatter::Base``) defines a set of core formatting methods useful for generating content.
These methods can be overridden in subclassed formatters to do anything. **The only limit is your
imagination.**

    ack_info
    additional_details
    additional_info
    alert_ack_url
    host_info
    notes
    notification_info
    recipients_email_link
    short_ack_info
    short_state_detail
    state_info

``Formatter::Base`` also includes helper methods that are used to store or manipulate content in the
``@content`` hash:

    add_attachments - Add an attachment path to be referenced in an ``Email`` message.
    add_html - Concatenate HTML for the given section.
    add_text - Concatenate HTML for the given section.
    line_break - Generate a line break for both text and HTML content.

See below for an example of content generated using some of the above methods.

![nagios-herald-formatter-content-example.png](/docs/images/nagios-herald-formatter-content-example.png)

## Writing the Formatter

To write a formatter, create a new formatter class (i.e. ``check_disk.rb``) and inherit from ``NagiosHerald::Formatter``.

```ruby
module NagiosHerald
  module Formatter
    class CheckDisk < NagiosHerald::Formatter
      include NagiosHerald::Logging

      def additional_details
        "nagios-herald makes alerting more bearable."
      end

    end
  end
end
```

### Naming Convention

* Formatters live in ``lib/nagios-herald/formatters``.
* The file names **MUST** lower-cased and underscored.
* The class names **MUST** be CamelCased.

For example, our ``CheckDisk`` formatter class would reside in a file named ``check_disk.rb``.

This is necessary as ``nagios-herald`` preloads all known formatters when it starts so that it can
dynamically instantiate the appropriate formatter it needs when it's ready.

### Overriding Methods

Any of the core formatting methods can be overridden in your subclass.  It's recommended that the helper methods
(i.e. ``add_(attachment|html|text)`` not be overridden.

An example of an overridden ``additional_info`` method could be:

```ruby
def additional_info
  section = __method__  # this defines the section key in the formatter's content hash
  hostname  = get_nagios_var("NAGIOS_HOSTNAME")
  add_text "#{hostname} blew up!"
  add_html "#{hostname} <b>blew</b> up!"
end
```
